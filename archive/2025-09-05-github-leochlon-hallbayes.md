---
date: '2025-09-05'
description: The HallBayes toolkit provides a mechanism for post-hoc calibration of
  large language models, enabling the assessment of hallucination risks and decisions
  to answer or refuse queries. Utilizing the Expectation-level Decompression Law (EDFL),
  it establishes risk bounds for responses without retraining, solely leveraging the
  OpenAI Chat Completions API. Two deployment modes allow for evidence-based or closed-book
  queries, enhancing reliability in varied contexts. Key metrics, such as Information
  Sufficiency Ratio and Bits-to-Trust, facilitate robust decision-making under specified
  Service Level Agreements (SLAs). The implementation is licensed under MIT and is
  accessible on GitHub.
link: https://github.com/leochlon/hallbayes
tags:
- hallucination-risk
- machine-learning
- OpenAI
- API
- toolkit
title: GitHub - leochlon/hallbayes
---

[Skip to content](https://github.com/leochlon/hallbayes#start-of-content)

[leochlon](https://github.com/leochlon)/ **[hallbayes](https://github.com/leochlon/hallbayes)** Public

- [Notifications](https://github.com/login?return_to=%2Fleochlon%2Fhallbayes) You must be signed in to change notification settings
- [Fork\\
27](https://github.com/login?return_to=%2Fleochlon%2Fhallbayes)
- [Star\\
258](https://github.com/login?return_to=%2Fleochlon%2Fhallbayes)


### License

[MIT license](https://github.com/leochlon/hallbayes/blob/main/LICENSE)

[258\\
stars](https://github.com/leochlon/hallbayes/stargazers) [27\\
forks](https://github.com/leochlon/hallbayes/forks) [Branches](https://github.com/leochlon/hallbayes/branches) [Tags](https://github.com/leochlon/hallbayes/tags) [Activity](https://github.com/leochlon/hallbayes/activity)

[Star](https://github.com/login?return_to=%2Fleochlon%2Fhallbayes)

[Notifications](https://github.com/login?return_to=%2Fleochlon%2Fhallbayes) You must be signed in to change notification settings

# leochlon/hallbayes

main

[**1** Branch](https://github.com/leochlon/hallbayes/branches) [**0** Tags](https://github.com/leochlon/hallbayes/tags)

[Go to Branches page](https://github.com/leochlon/hallbayes/branches)[Go to Tags page](https://github.com/leochlon/hallbayes/tags)

Go to file

Code

Open more actions menu

## Folders and files

| Name | Name | Last commit message | Last commit date |
| --- | --- | --- | --- |
| ## Latest commit<br>[![leochlon](https://avatars.githubusercontent.com/u/60907456?v=4&size=40)](https://github.com/leochlon)[leochlon](https://github.com/leochlon/hallbayes/commits?author=leochlon)<br>[Added Mac OSX build](https://github.com/leochlon/hallbayes/commit/8dedad882a5b08829fd9bff89538f2c9e5b6bff3)<br>Sep 1, 2025<br>[8dedad8](https://github.com/leochlon/hallbayes/commit/8dedad882a5b08829fd9bff89538f2c9e5b6bff3) · Sep 1, 2025<br>## History<br>[3 Commits](https://github.com/leochlon/hallbayes/commits/main/) <br>Open commit details<br>[View commit history for this file.](https://github.com/leochlon/hallbayes/commits/main/) |
| [app](https://github.com/leochlon/hallbayes/tree/main/app "app") | [app](https://github.com/leochlon/hallbayes/tree/main/app "app") | [First Commit](https://github.com/leochlon/hallbayes/commit/4e65b70c6b6e0524d0ea0058b6356e846bb2db86 "First Commit") | Sep 1, 2025 |
| [electron](https://github.com/leochlon/hallbayes/tree/main/electron "electron") | [electron](https://github.com/leochlon/hallbayes/tree/main/electron "electron") | [First Commit](https://github.com/leochlon/hallbayes/commit/4e65b70c6b6e0524d0ea0058b6356e846bb2db86 "First Commit") | Sep 1, 2025 |
| [launch](https://github.com/leochlon/hallbayes/tree/main/launch "launch") | [launch](https://github.com/leochlon/hallbayes/tree/main/launch "launch") | [First Commit](https://github.com/leochlon/hallbayes/commit/4e65b70c6b6e0524d0ea0058b6356e846bb2db86 "First Commit") | Sep 1, 2025 |
| [release](https://github.com/leochlon/hallbayes/tree/main/release "release") | [release](https://github.com/leochlon/hallbayes/tree/main/release "release") | [Added Mac OSX build](https://github.com/leochlon/hallbayes/commit/8dedad882a5b08829fd9bff89538f2c9e5b6bff3 "Added Mac OSX build") | Sep 1, 2025 |
| [scripts](https://github.com/leochlon/hallbayes/tree/main/scripts "scripts") | [scripts](https://github.com/leochlon/hallbayes/tree/main/scripts "scripts") | [First Commit](https://github.com/leochlon/hallbayes/commit/4e65b70c6b6e0524d0ea0058b6356e846bb2db86 "First Commit") | Sep 1, 2025 |
| [.gitignore](https://github.com/leochlon/hallbayes/blob/main/.gitignore ".gitignore") | [.gitignore](https://github.com/leochlon/hallbayes/blob/main/.gitignore ".gitignore") | [First Commit](https://github.com/leochlon/hallbayes/commit/4e65b70c6b6e0524d0ea0058b6356e846bb2db86 "First Commit") | Sep 1, 2025 |
| [LICENSE](https://github.com/leochlon/hallbayes/blob/main/LICENSE "LICENSE") | [LICENSE](https://github.com/leochlon/hallbayes/blob/main/LICENSE "LICENSE") | [First Commit](https://github.com/leochlon/hallbayes/commit/4e65b70c6b6e0524d0ea0058b6356e846bb2db86 "First Commit") | Sep 1, 2025 |
| [README.md](https://github.com/leochlon/hallbayes/blob/main/README.md "README.md") | [README.md](https://github.com/leochlon/hallbayes/blob/main/README.md "README.md") | [updated readme](https://github.com/leochlon/hallbayes/commit/addc0a4d4a14d90de26f945a43a283548be5c397 "updated readme") | Sep 1, 2025 |
| [pyproject.toml](https://github.com/leochlon/hallbayes/blob/main/pyproject.toml "pyproject.toml") | [pyproject.toml](https://github.com/leochlon/hallbayes/blob/main/pyproject.toml "pyproject.toml") | [First Commit](https://github.com/leochlon/hallbayes/commit/4e65b70c6b6e0524d0ea0058b6356e846bb2db86 "First Commit") | Sep 1, 2025 |
| [requirements.txt](https://github.com/leochlon/hallbayes/blob/main/requirements.txt "requirements.txt") | [requirements.txt](https://github.com/leochlon/hallbayes/blob/main/requirements.txt "requirements.txt") | [First Commit](https://github.com/leochlon/hallbayes/commit/4e65b70c6b6e0524d0ea0058b6356e846bb2db86 "First Commit") | Sep 1, 2025 |
| View all files |

## Repository files navigation

# Hallucination Risk Calculator & Prompt Re-engineering Toolkit (OpenAI-only)

[Permalink: Hallucination Risk Calculator & Prompt Re-engineering Toolkit (OpenAI-only)](https://github.com/leochlon/hallbayes#hallucination-risk-calculator--prompt-re-engineering-toolkit-openai-only)

**Post-hoc calibration without retraining** for large language models. This toolkit turns a raw prompt into:

1. a **bounded hallucination risk** using the Expectation-level Decompression Law (EDFL), and
2. a **decision** to **ANSWER** or **REFUSE** under a target SLA, with transparent math (nats).

It supports two deployment modes:

- **Evidence-based:** prompts include _evidence/context_; rolling priors are built by erasing that evidence.
- **Closed-book:** prompts have _no evidence_; rolling priors are built by semantic masking of entities/numbers/titles.

All scoring relies **only** on the OpenAI Chat Completions API. No retraining required.

* * *

## Table of Contents

[Permalink: Table of Contents](https://github.com/leochlon/hallbayes#table-of-contents)

- [Install & Setup](https://github.com/leochlon/hallbayes#install--setup)
- [Core Mathematical Framework](https://github.com/leochlon/hallbayes#core-mathematical-framework)
- [Understanding System Behavior](https://github.com/leochlon/hallbayes#understanding-system-behavior)
- [Two Ways to Build Rolling Priors](https://github.com/leochlon/hallbayes#two-ways-to-build-rolling-priors)
- [API Surface](https://github.com/leochlon/hallbayes#api-surface)
- [Calibration & Validation](https://github.com/leochlon/hallbayes#calibration--validation)
- [Practical Considerations](https://github.com/leochlon/hallbayes#practical-considerations)
- [Project Layout](https://github.com/leochlon/hallbayes#project-layout)
- [Deployment Options](https://github.com/leochlon/hallbayes#deployment-options)

* * *

## Install & Setup

[Permalink: Install & Setup](https://github.com/leochlon/hallbayes#install--setup)

```
pip install --upgrade openai
export OPENAI_API_KEY=sk-...
```

> The module uses `openai>=1.0.0` and the Chat Completions API (e.g., `gpt-4o`, `gpt-4o-mini`).

* * *

## Core Mathematical Framework

[Permalink: Core Mathematical Framework](https://github.com/leochlon/hallbayes#core-mathematical-framework)

### The EDFL Principle

[Permalink: The EDFL Principle](https://github.com/leochlon/hallbayes#the-edfl-principle)

Let the binary event A be the thing you want to guarantee (e.g., **Answer** in decision mode, or **Correct** for factual accuracy).

Build an ensemble of **content-weakened prompts** (the _rolling priors_) Skk=1m. For the realized label y, estimate:

- **Information budget:**

Δ¯=1m∑kclip+(log⁡P(y)−log⁡Sk(y),B)
(one-sided clipping; default B=12 nats to prevent outliers while maintaining conservative bounds).

- **Prior masses:**qk=Sk(A), with:
  - q¯=1m∑kqk (average prior for EDFL bound)
  - qlo=minkqk (worst-case prior for SLA gating)

By EDFL, the achievable reliability is bounded by:

Δ¯≥KL(Ber(p)\|Ber(q¯))⇒p≤pmax(Δ¯,q¯)

Thus the **hallucination risk** (error) is bounded by RoH―≤1−pmax.

### Decision Rule (SLA Gating)

[Permalink: Decision Rule (SLA Gating)](https://github.com/leochlon/hallbayes#decision-rule-sla-gating)

For target hallucination rate h∗:

- **Bits-to-Trust:**B2T=KL(Ber(1−h∗)\|Ber(qlo))
- **Information Sufficiency Ratio:**ISR=Δ¯/B2T
- **ANSWER** iff ISR≥1_and_Δ¯≥B2T+margin (default `margin≈0.2` nats)

> **Why two priors?** The gate uses **worst-case**qlo for strict SLA compliance. The RoH bound uses **average**q¯ per EDFL theory. This dual approach ensures conservative safety while providing realistic risk bounds.

* * *

## Understanding System Behavior

[Permalink: Understanding System Behavior](https://github.com/leochlon/hallbayes#understanding-system-behavior)

### Expected Behavioral Patterns

[Permalink: Expected Behavioral Patterns](https://github.com/leochlon/hallbayes#expected-behavioral-patterns)

The toolkit exhibits different behaviors across query types, which is **mathematically consistent** with the framework:

#### Simple Arithmetic Queries

[Permalink: Simple Arithmetic Queries](https://github.com/leochlon/hallbayes#simple-arithmetic-queries)

**Observation:** May abstain despite apparent simplicity

**Explanation:**

- Models often attempt answers even with masked numbers (pattern recognition)
- This yields **low information lift**Δ¯≈0 between full prompt and skeletons
- Despite potentially low EDFL risk bound, worst-case prior gate triggers **abstention** (ISR < 1)

#### Named-Entity Factoids

[Permalink: Named-Entity Factoids](https://github.com/leochlon/hallbayes#named-entity-factoids)

**Observation:** Generally answered with confidence

**Explanation:**

- Masking entities/dates substantially reduces answer propensity in skeletons
- Restoring these yields **large**Δ¯ that clears B2T threshold
- System **answers** with tight EDFL risk bound

**This is not a bug but a feature**: The framework prioritizes safety through worst-case guarantees while providing realistic average-case bounds.

### Mitigation Strategies

[Permalink: Mitigation Strategies](https://github.com/leochlon/hallbayes#mitigation-strategies)

1. **Switch Event Measurement**
   - Use **Correct/Incorrect** instead of Answer/Refuse for factual QA
   - Skeletons without key information rarely yield correct results → large Δ¯
2. **Enhance Skeleton Weakening**
   - Implement mask-aware decision head that refuses on redaction tokens
   - Ensures skeletons have strictly lower "Answer" mass than full prompt
3. **Calibration Adjustments**
   - Relax h∗ slightly (e.g., 0.10 instead of 0.05) for higher answer rates
   - Reduce margin for less conservative gating
   - Increase sampling (n=7−10) for stability
4. **Provide Evidence**
   - Adding compact, relevant evidence increases Δ¯ while preserving bounds

* * *

## Two Ways to Build Rolling Priors

[Permalink: Two Ways to Build Rolling Priors](https://github.com/leochlon/hallbayes#two-ways-to-build-rolling-priors)

### 1) Evidence-based (when you have context)

[Permalink: 1) Evidence-based (when you have context)](https://github.com/leochlon/hallbayes#1-evidence-based-when-you-have-context)

- **Prompt** contains a field like `Evidence:` (or JSON keys)
- **Skeletons** erase the evidence content but preserve structure and roles; then permute blocks deterministically (seeded)
- **Decision head**: "Answer only if the provided evidence is sufficient; otherwise refuse."

**Example**

```
from scripts.hallucination_toolkit import OpenAIBackend, OpenAIItem, OpenAIPlanner

backend = OpenAIBackend(model="gpt-4o-mini")
prompt = (
    """Task: Answer strictly based on the evidence below.
Question: Who won the Nobel Prize in Physics in 2019?
Evidence:
- Nobel Prize press release (2019): James Peebles (1/2); Michel Mayor & Didier Queloz (1/2).
Constraints: If evidence is insufficient or conflicting, refuse.
"""
)
item = OpenAIItem(
    prompt=prompt,
    n_samples=5,
    m=6,
    fields_to_erase=["Evidence"],
    skeleton_policy="auto"
)
planner = OpenAIPlanner(backend, temperature=0.3)
metrics = planner.run(
    [item],
    h_star=0.05,
    isr_threshold=1.0,
    margin_extra_bits=0.2,
    B_clip=12.0,
    clip_mode="one-sided"
)
for m in metrics:
    print(f"Decision: {'ANSWER' if m.decision_answer else 'REFUSE'}")
    print(f"Rationale: {m.rationale}")
```

### 2) Closed-book (no evidence)

[Permalink: 2) Closed-book (no evidence)](https://github.com/leochlon/hallbayes#2-closed-book-no-evidence)

- **Prompt** has no evidence
- **Skeletons** apply **semantic masking** of:

  - Multi-word proper nouns (e.g., "James Peebles" → "\[…\]")
  - Years (e.g., "2019" → "\[…\]")
  - Numbers (e.g., "3.14" → "\[…\]")
  - Quoted spans (e.g., '"Nobel Prize"' → "\[…\]")
- **Masking strengths**: Progressive levels (0.25, 0.35, 0.5, 0.65, 0.8, 0.9) across skeleton ensemble
- **Mask-aware decision head** refuses if redaction tokens appear or key slots look missing

**Example**

```
from scripts.hallucination_toolkit import OpenAIBackend, OpenAIItem, OpenAIPlanner

backend = OpenAIBackend(model="gpt-4o-mini")
item = OpenAIItem(
    prompt="Who won the 2019 Nobel Prize in Physics?",
    n_samples=7,  # More samples for stability
    m=6,          # Number of skeletons
    skeleton_policy="closed_book"
)
planner = OpenAIPlanner(backend, temperature=0.3, q_floor=None)
metrics = planner.run(
    [item],
    h_star=0.05,           # Target max 5% hallucination
    isr_threshold=1.0,     # Standard ISR gate
    margin_extra_bits=0.2, # Safety margin in nats
    B_clip=12.0,          # Clipping bound
    clip_mode="one-sided" # Conservative clipping
)
for m in metrics:
    print(f"Decision: {'ANSWER' if m.decision_answer else 'REFUSE'}")
    print(f"Δ̄={m.delta_bar:.4f}, B2T={m.b2t:.4f}, ISR={m.isr:.3f}")
    print(f"EDFL RoH bound={m.roh_bound:.3f}")
```

**Tuning knobs (closed-book):**

- `n_samples=5–7` and `temperature≈0.3` stabilize priors
- `q_floor` (Laplace by default: $1/(n+2)$) prevents worst-case prior collapse to 0
- Adjust masking strength levels if a task family remains too answerable under masking

* * *

## API Surface

[Permalink: API Surface](https://github.com/leochlon/hallbayes#api-surface)

### Core Classes

[Permalink: Core Classes](https://github.com/leochlon/hallbayes#core-classes)

- `OpenAIBackend(model, api_key=None)` – wraps Chat Completions API
- `OpenAIItem(prompt, n_samples=5, m=6, fields_to_erase=None, skeleton_policy="auto")` – one evaluation item
- `OpenAIPlanner(backend, temperature=0.5, q_floor=None)` – runs evaluation:

  - `run(items, h_star, isr_threshold, margin_extra_bits, B_clip=12.0, clip_mode="one-sided") -> List[ItemMetrics]`
  - `aggregate(items, metrics, alpha=0.05, h_star, ...) -> AggregateReport`

### Helper Functions

[Permalink: Helper Functions](https://github.com/leochlon/hallbayes#helper-functions)

- `make_sla_certificate(report, model_name)` – creates formal SLA certificate
- `save_sla_certificate_json(cert, path)` – exports certificate for audit
- `generate_answer_if_allowed(backend, item, metric)` – only emits answer if decision was ANSWER

### ItemMetrics Fields

[Permalink: ItemMetrics Fields](https://github.com/leochlon/hallbayes#itemmetrics-fields)

Every `ItemMetrics` includes:

- `delta_bar`: Information budget (nats)
- `q_conservative`: Worst-case prior qlo
- `q_avg`: Average prior q¯
- `b2t`: Bits-to-Trust requirement
- `isr`: Information Sufficiency Ratio
- `roh_bound`: EDFL hallucination risk bound
- `decision_answer`: Boolean decision
- `rationale`: Human-readable explanation
- `meta`: Dict with `q_list`, `S_list_y`, `P_y`, `closed_book`, etc.

* * *

## Calibration & Validation

[Permalink: Calibration & Validation](https://github.com/leochlon/hallbayes#calibration--validation)

### Validation Set Calibration

[Permalink: Validation Set Calibration](https://github.com/leochlon/hallbayes#validation-set-calibration)

On a labeled validation set:

1. **Sweep the margin** parameter from 0 to 1 nats
2. For each margin, compute:
   - Empirical hallucination rate among answered items
   - Wilson upper bound at 95% confidence
3. **Select smallest margin** where Wilson upper bound ≤ target h∗ (e.g., 5%)
4. **Freeze policy**:


'\_' allowed only in math mode






```
$(h^*, \tau, \text{margin}, B, \text{clip_mode}, m, r, \text{skeleton_policy})$
```


### Portfolio Reporting

[Permalink: Portfolio Reporting](https://github.com/leochlon/hallbayes#portfolio-reporting)

The toolkit provides comprehensive metrics:

- Answer/abstention rates
- Empirical hallucination rate + Wilson bound
- Distribution of per-item EDFL RoH bounds
- Worst-case and median risk bounds
- Complete audit trail

* * *

## Practical Considerations

[Permalink: Practical Considerations](https://github.com/leochlon/hallbayes#practical-considerations)

### Choosing the Right Event

[Permalink: Choosing the Right Event](https://github.com/leochlon/hallbayes#choosing-the-right-event)

The default event is the **decision**A=Answer. However:

| Task Type | Recommended Event | Rationale |
| --- | --- | --- |
| Factual QA | **Correct/Incorrect** | Directly measures hallucination |
| Decision Support | **Answer/Refuse** | Measures confidence to respond |
| Creative Writing | **Answer/Refuse** | Correctness often undefined |

For tasks where skeletons still trigger answers frequently (causing Δ¯≈0), switching to **Correctness** event with task-specific grading dramatically improves performance.

### Common Issues & Solutions

[Permalink: Common Issues & Solutions](https://github.com/leochlon/hallbayes#common-issues--solutions)

#### Issue: Δ¯=0 with RoH―≈0

[Permalink: Issue: $\bar{\Delta} = 0$ with $\overline{\mathrm{RoH}} \approx 0$](https://github.com/leochlon/hallbayes#issue-bardelta--0-with-overlinemathrmroh-approx-0)

**Not a contradiction!** The gate uses worst-case qlo; the bound uses average q¯.

- **Solution**: Increase `n_samples`, lower decision temperature, ensure skeletons truly weaken the event

#### Issue: Hit a low Δ¯ ceiling

[Permalink: Issue: Hit a low $\bar{\Delta}$ ceiling](https://github.com/leochlon/hallbayes#issue-hit-a-low-bardelta-ceiling)

**Cause**: Clipping may be too aggressive

- **Solution**: Increase `B_clip` (default 12) and use `clip_mode="one-sided"`

#### Issue: Arithmetic still refuses

[Permalink: Issue: Arithmetic still refuses](https://github.com/leochlon/hallbayes#issue-arithmetic-still-refuses)

**Cause**: Pattern recognition allows answers even with masked numbers

- **Solutions**:

  - Switch to **Correctness** event
  - Reduce masking strength for numbers on subset of skeletons
  - Provide worked examples as evidence

#### Issue: Prior collapse (qlo→0)

[Permalink: Issue: Prior collapse ($q_{\text{lo}} \to 0$)](https://github.com/leochlon/hallbayes#issue-prior-collapse-q_textlo-to-0)

**Cause**: All skeletons strongly refuse

- **Solution**: Apply prior floor (default Laplace: $1/(n+2)$) or use quantile prior

### Performance Characteristics

[Permalink: Performance Characteristics](https://github.com/leochlon/hallbayes#performance-characteristics)

| Metric | Typical Value | Notes |
| --- | --- | --- |
| Latency per item | 2-5 seconds | 7 samples × 7 variants (1 full + 6 skeletons) |
| API calls | (1+m)×⌈n/batch⌉ | Can be parallelized |
| Accuracy | Wilson-bounded at 95% | Empirically validated |
| Cost | ~$0.01-0.03 per item | Using gpt-4o-mini |

### Stability Guidelines

[Permalink: Stability Guidelines](https://github.com/leochlon/hallbayes#stability-guidelines)

1. **Sampling parameters**:
   - Use n≥5 samples per variant
   - Keep temperature ∈\[0.2,0.5\] for decision head
   - Lower temperature → more stable priors
2. **Skeleton ensemble**:
   - Use m≥6 skeletons
   - Ensure diversity in masking strengths
   - Verify skeletons are meaningfully weaker
3. **Clipping strategy**:
   - Always use one-sided clipping for conservative bounds
   - Set B≥10 nats to avoid artificial ceilings
   - Monitor clipping frequency in logs

* * *

## Project Layout

[Permalink: Project Layout](https://github.com/leochlon/hallbayes#project-layout)

```
.
├── app/                    # Application entry points
│   ├── web/web_app.py     # Streamlit UI
│   ├── cli/frontend.py    # Interactive CLI
│   ├── examples/          # Example scripts
│   └── launcher/entry.py  # Unified launcher
├── scripts/               # Core module
│   ├── hallucination_toolkit.py
│   └── build_offline_backend.sh
├── electron/              # Desktop wrapper
├── launch/                # Platform launchers
├── release/              # Packaged artifacts
├── bin/                  # Offline backend binary
├── requirements.txt
├── pyproject.toml
└── README.md

```

* * *

## Deployment Options

[Permalink: Deployment Options](https://github.com/leochlon/hallbayes#deployment-options)

### 1\. Direct Python Usage

[Permalink: 1. Direct Python Usage](https://github.com/leochlon/hallbayes#1-direct-python-usage)

```
from scripts.hallucination_toolkit import (
    OpenAIBackend, OpenAIItem, OpenAIPlanner,
    make_sla_certificate, save_sla_certificate_json
)

# Configure and run
backend = OpenAIBackend(model="gpt-4o-mini")
items = [OpenAIItem(prompt="...", n_samples=7, m=6)]
planner = OpenAIPlanner(backend, temperature=0.3)
metrics = planner.run(items, h_star=0.05)

# Generate SLA certificate
report = planner.aggregate(items, metrics)
cert = make_sla_certificate(report, model_name="GPT-4o-mini")
save_sla_certificate_json(cert, "sla.json")
```

### 2\. Web Interface (Streamlit)

[Permalink: 2. Web Interface (Streamlit)](https://github.com/leochlon/hallbayes#2-web-interface-streamlit)

```
streamlit run app/web/web_app.py
```

### 3\. One-Click Launcher

[Permalink: 3. One-Click Launcher](https://github.com/leochlon/hallbayes#3-one-click-launcher)

- **Windows**: Double-click `launch/Launch App.bat`
- **macOS**: Double-click `launch/Launch App.command`
- **Linux**: Run `bash launch/launch.sh`

First run creates `.venv` and installs dependencies automatically.

### 4\. Desktop App (Electron)

[Permalink: 4. Desktop App (Electron)](https://github.com/leochlon/hallbayes#4-desktop-app-electron)

Development:

```
cd electron
npm install
npm run start
```

Build installers:

```
npm run build
```

### 5\. Offline Backend (PyInstaller)

[Permalink: 5. Offline Backend (PyInstaller)](https://github.com/leochlon/hallbayes#5-offline-backend-pyinstaller)

Build single-file executable:

```
# macOS/Linux
bash scripts/build_offline_backend.sh

# Windows
scripts\build_offline_backend.bat
```

Creates `bin/hallucination-backend[.exe]` with bundled Python, Streamlit, and dependencies.

* * *

## Minimal End-to-End Example

[Permalink: Minimal End-to-End Example](https://github.com/leochlon/hallbayes#minimal-end-to-end-example)

```
from scripts.hallucination_toolkit import (
    OpenAIBackend, OpenAIItem, OpenAIPlanner,
    make_sla_certificate, save_sla_certificate_json,
    generate_answer_if_allowed
)

# Setup
backend = OpenAIBackend(model="gpt-4o-mini")

# Prepare items
items = [\
    OpenAIItem(\
        prompt="Who won the 2019 Nobel Prize in Physics?",\
        n_samples=7,\
        m=6,\
        skeleton_policy="closed_book"\
    ),\
    OpenAIItem(\
        prompt="If James has 5 apples and eats 3, how many remain?",\
        n_samples=7,\
        m=6,\
        skeleton_policy="closed_book"\
    )\
]

# Run evaluation
planner = OpenAIPlanner(backend, temperature=0.3)
metrics = planner.run(
    items,
    h_star=0.05,           # Target 5% hallucination max
    isr_threshold=1.0,     # Standard threshold
    margin_extra_bits=0.2, # Safety margin
    B_clip=12.0,          # Clipping bound
    clip_mode="one-sided" # Conservative mode
)

# Generate report and certificate
report = planner.aggregate(items, metrics, alpha=0.05, h_star=0.05)
cert = make_sla_certificate(report, model_name="GPT-4o-mini")
save_sla_certificate_json(cert, "sla_certificate.json")

# Show results
for item, m in zip(items, metrics):
    print(f"\nPrompt: {item.prompt[:50]}...")
    print(f"Decision: {'ANSWER' if m.decision_answer else 'REFUSE'}")
    print(f"Risk bound: {m.roh_bound:.3f}")
    print(f"Rationale: {m.rationale}")

    # Generate answer if allowed
    if m.decision_answer:
        answer = generate_answer_if_allowed(backend, item, m)
        print(f"Answer: {answer}")
```

## License

[Permalink: License](https://github.com/leochlon/hallbayes#license)

This project is licensed under the MIT License — see the LICENSE file for details.

## Attribution

[Permalink: Attribution](https://github.com/leochlon/hallbayes#attribution)

Developed by Hassana Labs ( [https://hassana.io](https://hassana.io/)).

This implementation follows the framework from the paper “Compression Failure in LLMs: Bayesian in Expectation, Not in Realization” (NeurIPS 2024 preprint) and related EDFL/ISR/B2T methodology.

## About

No description, website, or topics provided.


### Resources

[Readme](https://github.com/leochlon/hallbayes#readme-ov-file)

### License

[MIT license](https://github.com/leochlon/hallbayes#MIT-1-ov-file)

[Activity](https://github.com/leochlon/hallbayes/activity)

### Stars

[**258**\\
stars](https://github.com/leochlon/hallbayes/stargazers)

### Watchers

[**2**\\
watching](https://github.com/leochlon/hallbayes/watchers)

### Forks

[**27**\\
forks](https://github.com/leochlon/hallbayes/forks)

[Report repository](https://github.com/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Fleochlon%2Fhallbayes&report=leochlon+%28user%29)

## [Releases](https://github.com/leochlon/hallbayes/releases)

No releases published

## [Packages](https://github.com/users/leochlon/packages?repo_name=hallbayes)

No packages published

## Languages

- [Python87.2%](https://github.com/leochlon/hallbayes/search?l=python)
- [JavaScript6.5%](https://github.com/leochlon/hallbayes/search?l=javascript)
- [HTML2.4%](https://github.com/leochlon/hallbayes/search?l=html)
- [Shell2.3%](https://github.com/leochlon/hallbayes/search?l=shell)
- [Batchfile1.6%](https://github.com/leochlon/hallbayes/search?l=batchfile)
